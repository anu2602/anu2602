<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Anuradha Chowdhary" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Anuradha Chowdhary" /> <title> Writing Airflow Plugin - Anuradha Chowdhary </title> <link rel="alternate" href="https://www.achowdhary.com/writing-airflow-plugin/" hreflang="en-US" /> <link rel="canonical" href="https://www.achowdhary.com/writing-airflow-plugin/" /> <meta name="description" content="A step by step guide to get started with Airflow Plugin Development." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Writing Airflow Plugin | Anuradha Chowdhary" /> <meta property="og:title" content="Writing Airflow Plugin | Anuradha Chowdhary" /> <meta property="og:type" content="website" /> <meta property="og:url" content="https://www.achowdhary.com/writing-airflow-plugin/" /> <meta property="og:description" content="A step by step guide to get started with Airflow Plugin Development." /> <meta property="og:image" content="https://www.achowdhary.com/wirting-airflow-plugin/plugin.jpeg" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Writing Airflow Plugin | anu2602" /> <meta name="twitter:url" content="https://www.achowdhary.com/writing-airflow-plugin/" /> <meta name="twitter:site" content="@anu2602" /> <meta name="twitter:creator" content="@anu2602" /> <meta name="twitter:description" content="A step by step guide to get started with Airflow Plugin Development." /> <meta name="twitter:image" content="https://www.achowdhary.com/wirting-airflow-plugin/plugin.jpeg" /> <link type="application/atom+xml" rel="alternate" href="https://www.achowdhary.com/feed.xml" title="Anuradha Chowdhary" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/posts/">posts</a><a class="menu-link" href="/about/">about</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#airflow">AIRFLOW</a>, <a class="tag" href="/tags/#guide">GUIDE</a>, <a class="tag" href="/tags/#howto">HOWTO</a> </span> </div> <h1 class="header-title" itemprop="headline">Writing Airflow Plugin</h1> <div class="post-meta"> <time datetime="2022-11-07T16:50:47+05:30" itemprop="datePublished"> Nov 07, 2022 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Anuradha Chowdhary</span> </span> <time hidden datetime="" itemprop="dateModified"> Nov 07, 2022 </time> <span hidden itemprop="publisher" itemtype="Person">Anuradha Chowdhary</span> <span hidden itemprop="image">/wirting-airflow-plugin/plugin.jpeg</span> <span hidden itemprop="mainEntityOfPage"><figure> <img src="plugin.jpg" alt="plugin" /> <figcaption style="color: grey !important;"> Photo by <a href="https://unsplash.com/@purzlbaum" style="color: grey !important;" target="_blank">Claudio Schwarz </a> </figcaption> </figure> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <figure> <img src="plugin.jpg" alt="plugin" /> <figcaption style="color: grey !important;"> Photo by <a href="https://unsplash.com/@purzlbaum" style="color: grey !important;" target="_blank">Claudio Schwarz </a> </figcaption> </figure> <p>I recently pulished <a href="https://github.com/anu2602/aerofoil">Aerofoil</a>, an Airflow Plugin. In the process, I reallized there isn’t a good Guide on writing Airflow Pluins, so here is I am writing a simple, practical and hopefully useful guide.</p> <h3 id="airflow-plugins"> <a href="#airflow-plugins" class="anchor-head"></a> Airflow Plugins </h3> <p>Airflow has a simple plugin manager built-in that can integrate external features to its core by either dropping files in your <code class="language-plaintext highlighter-rouge">$AIRFLOW_HOME/plugins</code> folder or installing python modulues that implement plugin’s interface. Pluings are useful for extending and customizing Airflow as per the needs. Plugin can be used for:</p> <ul> <li>Creating new Operatos, Sensors, Hooks</li> <li>Creating macros</li> <li>Modifying Airflow UI</li> <li>Custom timetables</li> <li>Event Listeners</li> </ul> <h3 id="why-write-airflow-plugin"> <a href="#why-write-airflow-plugin" class="anchor-head"></a> Why Write Airflow Plugin? </h3> <ul> <li>To provide connectivity to your data product: You provide a data service and chances are your customers are using Airflow to connect to your system. They all are writing same code, instead if you could provide a pluin, that can make life easy for them.</li> <li>To customize your Airflow Installation: You may want to add Menu Links, change UI for your Airflow installation e.g you want to provide link to your documentation from Airflow or you want build add a simple data exploration capability.</li> <li>To add custom or customized Operator/Hooks/Sensors: Though there are provider packages for almost any meaningful system you want to connect via Airflow, you may sometime need to write your own operator or modify operator.</li> <li>and so on ..</li> </ul> <h3 id="plugin-packaging"> <a href="#plugin-packaging" class="anchor-head"></a> Plugin Packaging </h3> <p>There are two simple way to package plugin. First is simply dropping files into Airflow <code class="language-plaintext highlighter-rouge">plugins</code> folder. <code class="language-plaintext highlighter-rouge">plugins</code> Folder is defined in <code class="language-plaintext highlighter-rouge">airflow.cfg</code>, airflow loads the code in this folder. This is simplest way of writing plugin, and if you are doing this you can probably skip this guide and user Airflow documentation. This guide is more suited to someone who intend to publish a reusable plugin.</p> <h3 id="plugin-src-structure"> <a href="#plugin-src-structure" class="anchor-head"></a> Plugin src structure: </h3> <p>I recommend following structure for your plugin:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src/
  &lt;mymodule&gt;/
  operators (optional)
  sensors (optional)
  views (optional)
  static (optional)
  templates (optional)
  __init__.py
  &lt;myplugin&gt;.py  
setup.py
README.md
MANIFEST.in
</code></pre></div></div> <h3 id="development-environment"> <a href="#development-environment" class="anchor-head"></a> Development Environment </h3> <p>First of all you need to have a running Airflow in your development environment in order for you to be able to test, which is fairly straight forward. After that you make want to find your <code class="language-plaintext highlighter-rouge">plugins</code> folder in <code class="language-plaintext highlighter-rouge">airflow.cfg</code>, this is usually <code class="language-plaintext highlighter-rouge">$AIRFLOW_HOM/plugins</code>.</p> <p>To be able to test, I recommend you create a symlink to <code class="language-plaintext highlighter-rouge">&lt;mymodule&gt;</code> in <code class="language-plaintext highlighter-rouge">plugins</code> folder.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd $AIRFLOW_HOME/plugins
ln -s /path/to/plugin-code/src/&lt;mymodule&gt; . 
</code></pre></div></div> <p>Also set <code class="language-plaintext highlighter-rouge">reload_on_plugin_change</code> to <code class="language-plaintext highlighter-rouge">true</code> in <code class="language-plaintext highlighter-rouge">[webserver]</code> section of <code class="language-plaintext highlighter-rouge">airflow.cfg</code>. This is specially helpful if you are developing new UI features and you want to preview your changes without restarting webservers. Take it with a pinch of salt, as some of the changes in the template do not reflect and you need to restart your webserver.</p> <h3 id="entry-point"> <a href="#entry-point" class="anchor-head"></a> Entry Point </h3> <p>Entry point to the plugin is the plugin file. The file should define a class exending <code class="language-plaintext highlighter-rouge">airflow.plugins_manager.AirflowPlugin</code></p> <h4 id="example"> <a href="#example" class="anchor-head"></a> Example </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from airflow.plugins_manager import AirflowPlugin

from flask import Blueprint
from flask_appbuilder import expose, BaseView as AppBuilderBaseView
from airflow.hooks.base import BaseHook

#Import your custome classes
from &lt;mymodule&gt;.operators import MyHook
rom &lt;mymodule&gt;.views import MyView

def my_macro():
    pass

my_view = MyView()

my_bp = Blueprint(
	'my_plugin', __name__,
	 template_folder='templates',
	 static_folder='&lt;mymodule&gt;/static',
	 static_url_path='/static/&lt;myurlplath&gt;'
)

my_pkg = {
	'name' : 'My View',
	'category' : 'My New Menu',
	'view': my_view
}

my_mitem = {
    "name": "Google",
    "href": "https://www.google.com",
    "category": "My New Menu'",
}

class MyAirflowPlugin(AirflowPlugin):
    name = "my_plugin"
    hooks = [MyHook]
    macros = [my_macro]
    flask_blueprints = [my_bp]
    appbuilder_views = [my_pkg]
    appbuilder_menu_items = [my_mitem]
</code></pre></div></div> <h4 id="understanding-the-plugin-interface"> <a href="#understanding-the-plugin-interface" class="anchor-head"></a> Understanding the Plugin Interface </h4> <p><code class="language-plaintext highlighter-rouge">from airflow.plugins_manager import AirflowPlugin</code> Airflow plugin needs to extend the AirflowPlugin class as displayed above and below items needs to be defined in your subclass as per your need.</p> <div class="datatable-begin"></div> <table> <thead> <tr> <th>Plugin Property</th> <th>Usage</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">name</code></td> <td>This is the name of your Plugin</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">hooks</code></td> <td>List of your custom Hook classes go here</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">macro</code></td> <td>A macro can be defined as a function, list of macros go here</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">flask_blueprints</code></td> <td>A list of <a href="https://stackoverflow.com/questions/24420857/what-are-flask-blueprints-exactly" target="_blank">blueprints</a> created for Flask, usually you will have only one.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">appbuilder_views</code></td> <td>These are Menu Items for your view (UI Screens). You can either add to existing Menu Group (Category) or create a new one.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">appbuilder_menu_items</code></td> <td>Additional external links to be added to Airflow Menu</td> </tr> </tbody> </table> <div class="datatable-end"></div> <h4 id="entry-point-1"> <a href="#entry-point-1" class="anchor-head"></a> Entry Point </h4> <p>Class implementing plugin interface is the entrypoint for your plugin. If you drop your pluggin into the Airflow’s <code class="language-plaintext highlighter-rouge">plugins</code> folder, creating a AirflowPlugin implmentation and keeping is sufficient. But if you are creating a python package and plugin is loaded via setuptools entrypoint mechanism. In your setup.py configure entrypoint as mentioned below:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>entry_points={
        'apache_airflow_provider': [
            'provider_info=&lt;mymoduler&gt;.__init__:get_provider_info'
        ],
        'airflow.plugins': [
            'aerofoil=&lt;mymodule&gt;.my_plugin:MyPlugin'
        ]
    },
</code></pre></div></div> <p>Where MyPlugin is implemenation of AirflowPlugin as defined in <code class="language-plaintext highlighter-rouge">mymodule/my_plugin.py</code>.</p> <h3 id="references"> <a href="#references" class="anchor-head"></a> References </h3> <ol> <li><a href="https://airflow.apache.org/docs/apache-airflow/stable/plugins.html" target="_blank">Airflow Plugin Documentation</a></li> <li><a href="https://github.com/anu2602/aerofoil" target="_blank">Aerofoil code</a></li> <li><a href="https://github.com/airflow-plugins" target="_blank">Airflow Plugins in Github</a></li> <li><a href="https://stackoverflow.com/questions/24420857/what-are-flask-blueprints-exactly" target="_blank">What is Flask Blueprint</a></li> <li><a href="https://flask-appbuilder.readthedocs.io/en/latest/config.html" target="_blank">Flask-AppBuilder configuration reference</a></li> </ol> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/announcing-aerofoil/" > <div class="nav-arrow">Previous</div> <span class="post-title">Annouuncing Aerofoil - An Airflow Plugin</span> </a> </nav> <nav class="post-nav"></nav> <div id="disqus_thread"></div> <script> (function() { var d = document, s = d.createElement('script'); s.src = 'https://achowdhary.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <footer class="footer"> <a class="footer_item" href="/thanks">ack.</a> <a class="footer_item" href="javascript::void(0)">resume</a> <a class="footer_item" href="/feed.xml">rss</a> <!--span class="footer_item">&copy; 2022</span--> <small class="footer_copyright"> &copy 2022 Anuradha Chowdhary </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
