<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Anuradha Chowdhary" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Anuradha Chowdhary" /> <title> Disable Console Access for Jupyter Hub. - Anuradha Chowdhary </title> <link rel="alternate" href="https://www.achowdhary.com/juppyter-hub-disable-console-access/" hreflang="en-US" /> <link rel="canonical" href="https://www.achowdhary.com/juppyter-hub-disable-console-access/" /> <meta name="description" content="Disable Terminal / Console / Shell access from Jupyter Hub." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Disable Console Access for Jupyter Hub. | Anuradha Chowdhary" /> <meta property="og:title" content="Disable Console Access for Jupyter Hub. | Anuradha Chowdhary" /> <meta property="og:type" content="website" /> <meta property="og:url" content="https://www.achowdhary.com/juppyter-hub-disable-console-access/" /> <meta property="og:description" content="Disable Terminal / Console / Shell access from Jupyter Hub." /> <meta property="og:image" content="https://www.achowdhary.com/jupyter-hub-disable-console-access/no-access.jpg" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Disable Console Access for Jupyter Hub. | anu2602" /> <meta name="twitter:url" content="https://www.achowdhary.com/juppyter-hub-disable-console-access/" /> <meta name="twitter:site" content="@anu2602" /> <meta name="twitter:creator" content="@anu2602" /> <meta name="twitter:description" content="Disable Terminal / Console / Shell access from Jupyter Hub." /> <meta name="twitter:image" content="https://www.achowdhary.com/jupyter-hub-disable-console-access/no-access.jpg" /> <link type="application/atom+xml" rel="alternate" href="https://www.achowdhary.com/feed.xml" title="Anuradha Chowdhary" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/posts/">posts</a><a class="menu-link" href="/about/">about</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#jupyter-hub">JUPYTER HUB</a>, <a class="tag" href="/tags/#jupyter-lab">JUPYTER LAB</a> </span> </div> <h1 class="header-title" itemprop="headline">Disable Console Access for Jupyter Hub.</h1> <div class="post-meta"> <time datetime="2021-03-07T08:28:47+05:30" itemprop="datePublished"> Mar 07, 2021 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Anuradha Chowdhary</span> </span> <time hidden datetime="" itemprop="dateModified"> Mar 07, 2021 </time> <span hidden itemprop="publisher" itemtype="Person">Anuradha Chowdhary</span> <span hidden itemprop="image">/jupyter-hub-disable-console-access/no-access.jpg</span> <span hidden itemprop="mainEntityOfPage"><figure> <img src="no-access.jpg" alt="You are not allowed!" /> <figcaption style="color: grey !important;"> Photo by <a href="https://unsplash.com/@fionakiwi" style="color: grey !important;" target="_blank">Fiona Jackson </a> </figcaption> </figure> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <figure> <img src="no-access.jpg" alt="You are not allowed!" /> <figcaption style="color: grey !important;"> Photo by <a href="https://unsplash.com/@fionakiwi" style="color: grey !important;" target="_blank">Fiona Jackson </a> </figcaption> </figure> <h4 id="can-you-disable-terminal--access-in-jupyterhub"> <a href="#can-you-disable-terminal--access-in-jupyterhub" class="anchor-head"></a> Can you disable terminal access in Jupyterhub? </h4> <p>The answer is not a simple Yes or No. It’s is a bit compliated and hence this post.</p> <h4 id="can-you-stop-showing-terminal-from-jupyter-ui"> <a href="#can-you-stop-showing-terminal-from-jupyter-ui" class="anchor-head"></a> Can you stop showing Terminal from Jupyter UI? </h4> <p>This has a simple answer ☺️ :relaxed:. However ther is no configuration, the configuration <code class="language-plaintext highlighter-rouge">NotebookApp.terminals_enabled=False</code> works in single user notebook but does not work in <code class="language-plaintext highlighter-rouge">jupyterhub</code> \ <code class="language-plaintext highlighter-rouge">jupyterlab</code> setup. Fortunately there is a simple way to achieve this. If you uninstall a package called ‘terminado’, terminals will disappear.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	pip uninstall -y terminado
</code></pre></div></div> <h4 id="does-this-secure-my-jupyter-hub-setup"> <a href="#does-this-secure-my-jupyter-hub-setup" class="anchor-head"></a> Does this secure my Jupyter Hub Setup? </h4> <p>No, because anything you can do from the terminal, you can do from a notebook anyway, so don’t rely on this as any kind of security measure. A user can:</p> <ul> <li>open a Python notebook and use the %%bash or ! shell magics.</li> <li>open a Python notebook, import subprocess, and execute arbitrary commands.</li> <li>open a notebook for pretty much any other language and execute a shell child process (e.g., s”ls -l” ! in Scala).</li> </ul> <p>Even if you could turn off magic shell commands Python itself has the permissions to do the exact same things,so there’s very little point in even trying. There is no practical way to block the user from running system commands. Even JupyterHub, is designed with the use-case of semi-trusted users, and requires very careful set up to allow for untrusted users. From Jupyter Hub security Documentation:</p> <blockquote> <p>JupyterHub is designed to be a simple multi-user server for modestly sized groups of semi-trusted users. While the design reflects serving semi-trusted users, JupyterHub is not necessarily unsuitable for serving untrusted users.</p> </blockquote> <h4 id="what-is-my-best-options-for-securing-my-jupyterhub"> <a href="#what-is-my-best-options-for-securing-my-jupyterhub" class="anchor-head"></a> What is my best options for securing my JupyterHub? </h4> <p>If you are letting untrusted users execute code on your system, the safest approach is to run inside container without access to the system outside the container. JupyterHub has support for containerisation of notebook servers, so each user will have their own (e.g. Docker) container and you can limit access to files. If they mess up their own container it would not mess up other users or the main server. It would alsow be relatively easy to setup backup and restore data for users.</p> <p>Since much of the point of IPython and Jupyter is arbitrary code execution, the security model for deploying Jupyter ought to be applying restrictions at the process/container level, rather than disabling UI for running commands.</p> <p>But setting up JupyterHub instance with docker is not trivial and if you are dealing with very small team of trusted users, you should try to train and guide users. They would most likely anyway have access to server with sudo access.</p> <h4 id="is-there-any-other-alternative"> <a href="#is-there-any-other-alternative" class="anchor-head"></a> Is there any other alternative? </h4> <p>If you want to use Linux Containers for isolation and security benefits, but don’t want the headache and complexity of container image management, then you could use the <code class="language-plaintext highlighter-rouge">SystemdSpawner</code>. However please note that the Jupyterhub must be run as <code class="language-plaintext highlighter-rouge">root</code> to use <code class="language-plaintext highlighter-rouge">SystemdSpawner</code>.</p> <p>You could also use <code class="language-plaintext highlighter-rouge">SudoSpawner</code> for isolation but <code class="language-plaintext highlighter-rouge">SystemdSpawner</code> provides more features, options and isolation support including memory, CPU and <code class="language-plaintext highlighter-rouge">/tmp</code> isolation.</p> <h4 id="is-there-any-simple-hack"> <a href="#is-there-any-simple-hack" class="anchor-head"></a> Is there any simple hack? </h4> <p>There is a hack to prevent users from launching a shell by setting setting the SHELL of the user or process to <code class="language-plaintext highlighter-rouge">/bin/false</code>; This will prevent any shell from launching a shell. This can work well with <code class="language-plaintext highlighter-rouge">SystemdSpawner</code> by setting <code class="language-plaintext highlighter-rouge">SHELL=/usr/false</code> in the systemd service file. But please remember this is a hack and resourceful developer will be able to find a workaround.</p> <h3 id="references"> <a href="#references" class="anchor-head"></a> References </h3> <ol> <li><a href="https://jupyterhub.readthedocs.io/en/stable/reference/websecurity.html" target="_blank">Jupyter Hub Security Overview</a></li> <li><a href="https://jupyterlab.readthedocs.io/en/stable/" target="_blank">Jupyter Lab Documentation</a></li> <li><a href="https://jupyterhub-dockerspawner.readthedocs.io/en/latest/" target="_blank">Jupyter Hub Docker Spawner</a></li> <li><a href="https://github.com/jupyterhub/zero-to-jupyterhub-k8s" target="_blank">Zero to Jupyter Hub</a></li> <li>[]Jupyter Hub Systemd Spawner](https://github.com/jupyterhub/systemdspawner){:target=”_blank”}</li> </ol> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/jekyll-github-pages-simplified/" > <div class="nav-arrow">Previous</div> <span class="post-title">Personal website/blog with Jekyll + Github.</span> </a> <a class="post-nav-item post-nav-next" href="/spark-cheat-sheet/"> <div class="nav-arrow">Next</div> <span class="post-title">Spark3 Cheat Sheet</span> </a> </nav> <nav class="post-nav"></nav> <div id="disqus_thread"></div> <script> (function() { var d = document, s = d.createElement('script'); s.src = 'https://achowdhary.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <footer class="footer"> <a class="footer_item" href="/thanks">ack.</a> <a class="footer_item" href="javascript::void(0)">resume</a> <a class="footer_item" href="/feed.xml">rss</a> <!--span class="footer_item">&copy; 2022</span--> <small class="footer_copyright"> &copy 2022 Anuradha Chowdhary </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
