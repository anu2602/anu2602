I"¬<p>If you are in enterprise environment, chances are you are already using Active Directory as standard authentication. Itegrating Airflow with your Enterprise Active Directory/SSO/LDAP will not only simplify user managementin Airflow but is also very convenient for users. They no longer need to remember yet another username/password.</p>

<figure>
<img src="door.jpg" alt="confused" />
<figcaption style="color: grey !important;"> 
	Photo by <a href="https://unsplash.com/@pechka" style="color: grey !important;" target="_blank">Dima Pechurin
</a> 
</figcaption>
</figure>

<h3 id="pre-requisite">Pre-requisite</h3>
<p>It is assumed that you have a working airflow setup with
<code class="language-plaintext highlighter-rouge">airflow version &gt;= 1.10.2</code> and <code class="language-plaintext highlighter-rouge">python version &gt;= 3.6</code></p>

<p>You will also need <code class="language-plaintext highlighter-rouge">python-ldap</code>, which can be installed using <code class="language-plaintext highlighter-rouge">pip install python-ldap</code> or <code class="language-plaintext highlighter-rouge">conda install python-ldap</code></p>

<p><code class="language-plaintext highlighter-rouge">python-ldap</code> package is based on OpenLDAP, so you need to have the development files (headers) in order to compile the Python module.</p>

<p><em>Debian/Ubuntu:</em><br />
<code class="language-plaintext highlighter-rouge">sudo apt-get install libsasl2-dev python-dev libldap2-dev libssl-dev</code></p>

<p>RedHat/CentOS:<br />
<code class="language-plaintext highlighter-rouge">sudo yum install python-devel openldap-devel</code></p>

<p>Airflow 1.10+ uses Flask-AppBuilder (FAB) for user interface. It is expected and obvious that the configuration follows FAB configuration. So if you run into issues, it would be worth  <a href="https://www.google.com/search?q=Flask-AppBuilder%20LDAP" target="_blank"> Searching Flask AppBuilder LDAP</a> instead of Airflow LDAP.</p>

<p>Make sure you have <code class="language-plaintext highlighter-rouge">rbac = true</code> in <code class="language-plaintext highlighter-rouge">airflow.cfg</code>.</p>

<p>Sdd <code class="language-plaintext highlighter-rouge">webserver_config.py</code> in <code class="language-plaintext highlighter-rouge">AIRFLOW_HOME</code>, with following contents.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
from airflow import configuration as conf
from flask_appbuilder.security.manager import AUTH_LDAP

# Do not delete this line, reqired by FAB for creating users in DB.
SQLALCHEMY_DATABASE_URI = conf.get('core', 'SQL_ALCHEMY_CONN')

CSRF_ENABLED = True

AUTH_TYPE = AUTH_LDAP

AUTH_ROLE_ADMIN = 'Admin'

#Allows user to register on first login
AUTH_USER_REGISTRATION = True

# User will have, viewer role on first login
# Options are Admin, Viewer, User, Op
# If you have custom role, you can use that too.
AUTH_USER_REGISTRATION_ROLE = "Viewer"

# Replace with your LDAP Server
AUTH_LDAP_SERVER = 'ldaps://myldapserver:636/' 

# Replace with your LDAP Base DN
AUTH_LDAP_SEARCH = 'DC=domain,DC=org,DC=com'

# Replace with your LDAP entry for service user / LDAP Bind User
AUTH_LDAP_BIND_USER = 'CN=ServiceUser,OU=serviceAccount,DC=domain,DC=org,DC=com'
# Bind user Password
AUTH_LDAP_BIND_PASSWORD = '**************'

# LDAP field used for UID
AUTH_LDAP_UID_FIELD = 'CN'

#TLS Settings, configure as per your LDAP/AD setup
AUTH_LDAP_USE_TLS = False
AUTH_LDAP_ALLOW_SELF_SIGNED = False
AUTH_LDAP_TLS_CACERTFILE = '/path/to/root_CA.crt' #You may not need this
</code></pre></div></div>

<h3 id="references">References</h3>
<ol>
  <li><a href="https://github.com/dpgaspar/Flask-AppBuilder/pull/1374" target="_blank">Airflow pull-request for AUTH_LDAP implementation</a></li>
  <li><a href="https://flask-appbuilder.readthedocs.io/en/latest/security.html" target="_blank">Flask-AppBuilder supported authentication types</a></li>
  <li><a href="https://www.python-ldap.org/en/latest/reference/index.html" target="_blank">python-ldap reference documentation</a></li>
  <li><a href="https://flask-appbuilder.readthedocs.io/en/latest/config.html" target="_blank">Flask-AppBuilder configuration reference</a></li>
</ol>
:ET